"0","# Spatial join tracts to counties"
"0",""
"0","pa_counties_proj <- st_transform(pa_counties, 5070)"
"0",""
"0","tract_centroids <- st_centroid(vulnerable_tracts_proj)"
"0","tract_centroids <- cbind(tract_centroids, vulnerable_tracts_proj)"
"0","tracts_with_county <- st_join(tract_centroids, pa_counties_proj, join = st_within)"
"0",""
"0","# Aggregate statistics by county"
"0","county_stats <- tracts_with_county %>%"
"0","  group_by(COUNTY_NAM) %>%          "
"0","  summarise("
"0","    n_vulnerable_tracts = n(),"
"0","    n_underserved = sum(distance_to_hospital_miles > 15, na.rm = TRUE),"
"0","    pct_underserved = n_underserved / n_vulnerable_tracts * 100,"
"0","    avg_distance_miles = mean(distance_to_hospital_miles, na.rm = TRUE),"
"0","    total_vulnerable_pop = sum(total_pop, na.rm = TRUE)"
"0","  ) %>%"
"0","  arrange(desc(pct_underserved))"
"0",""
"0","st_drop_geometry(county_stats)"
